import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import Flatten
from keras.constraints import maxnorm
from keras.optimizers import SGD
from keras.layers.convolutional import Conv2D
from keras.layers.convolutional import MaxPooling2D
from keras.utils import np_utils
from keras import initializers
from keras import backend as K
from keras.models import load_model
K.set_image_dim_ordering('th')

import os
import numpy as np
import scipy.io
import scipy.misc
import matplotlib.pyplot as plt
import tensorflow as tf
from PIL import Image


dict_rgb = {'accordion': (95.55592928799716, 85.35317160866477, 81.70358997691761),
'airplanes': (125.85152153015137, 137.31284164428712, 138.21201805114745),
'anchor': (130.82577078683036, 136.96873256138392, 133.66485014415923),
'ant': (140.00741577148438, 135.5483892531622, 118.08007376534599),
'BACKGROUND_Google': (153.2254407339484, 147.30719464647183, 142.3693905162607),
'barrel': (134.5070917657081, 121.09076187458444, 109.07621992395279),
'bass': (119.41676161024306, 121.33676260489004, 116.30342723705151),
'beaver': (127.49123614767323, 119.59112150772758, 108.97476992399797),
'binocular': (138.81235573508522, 136.6812614672112, 133.1925067323627),
'bonsai': (131.59748935699463, 128.1688141822815, 113.9662733078003),
'brain': (140.00359422333386, 131.18857434331153, 126.9566874601403),
'brontosaurus': (161.94471918150435, 161.19933940089027, 153.65343244685684),
'buddha': (136.91492919921876, 124.81696992761948, 112.74041389016544),
'butterfly': (136.12532932155736, 128.3366209596068, 112.07693850339113),
'camera': (155.92713012695313, 154.26056884765626, 156.30689575195314),
'cannon': (131.18338793377544, 125.42920063817223, 115.46421068768169),
'car_side': (112.48210627858232, 112.48210627858232, 112.48210627858232),
'ceiling_fan': (154.47513531624003, 144.07347334192156, 135.27951114735706),
'cellphone': (124.28752524165783, 118.3423917091499, 116.08653129965572),
'chair': (146.11615088678175, 137.09703703849547, 129.49218159337198),
'chandelier': (129.96947785849883, 117.25029661945094, 107.29076178720064),
'cougar_body': (129.30571600731383, 117.43156011053857, 105.19280356549203),
'cougar_face': (136.88055331465128, 122.41063303187273, 105.52315178470334),
'crab': (139.4681287791631, 129.03415544065712, 115.47725813356165),
'crayfish': (141.89171491350447, 134.5328848702567, 124.78327287946429),
'crocodile': (120.60399047851563, 114.47018310546875, 98.14221435546875),
'crocodile_head': (117.03505931181066, 112.10640821269914, 97.71354645373775),
'cup': (148.6301494397615, 138.21881210594847, 134.9237263997396),
'dalmatian': (134.78249256646455, 131.6620856897155, 124.88464264371503),
'dollar_bill': (160.39508056640625, 159.50562931941107, 144.75218435434195),
'dolphin': (88.80021503155048, 114.49605431189904, 143.7055692232572),
'dragonfly': (143.68841193704043, 149.72198845358457, 136.7821969424977),
'electric_guitar': (127.15362630208334, 116.12569661458333, 109.48038330078126),
'elephant': (126.41894245147705, 120.14373779296875, 108.7945613861084),
'emu': (135.81218906618514, 123.57206524543042, 104.63789914688974),
'euphonium': (155.6106595993042, 146.5311460494995, 137.3836154937744),
'ewer': (130.5083718692555, 125.57598805147059, 122.19115564682905),
'Faces': (126.4613560468301, 120.67409541689116, 112.48367933952946),
'Faces_easy': (137.02615251212285, 123.30527904992816, 116.58948693987966),
'ferry': (126.70888963386194, 132.81638074277052, 141.37505648029384),
'flamingo': (118.2573633905667, 111.13969034223415, 102.40087070749767),
'flamingo_head': (120.6533704969618, 100.56436089409722, 91.68924831814236),
'garfield': (192.50227445714614, 169.2796074362362, 138.91894890280332),
'gerenuk': (133.6546900132123, 121.38617840935203, 99.26077270507812),
'gramophone': (155.451447131587, 143.28415096507354, 130.57719750497856),
'grand_piano': (141.4292035343671, 134.00734394728536, 129.69946843927556),
'hawksbill': (80.72149353027343, 103.43272338867187, 117.92880065917969),
'headphone': (175.94869413829986, 175.10996791294642, 178.88204810732887),
'hedgehog': (127.56314425998264, 117.95857069227431, 104.15447206850405),
'helicopter': (133.09506780450994, 142.06245491721413, 147.23358223655006),
'ibis': (108.78170623779297, 108.58328628540039, 93.88399734497071),
'inline_skate': (163.9823490265877, 161.85164125504033, 162.5815173733619),
'joshua_tree': (119.59814262390137, 115.80997276306152, 117.42843055725098),
'kangaroo': (123.1984934252362, 120.53604480832122, 95.5804961448492),
'ketch': (148.779396458676, 157.13293189333197, 168.9385697214227),
'lamp': (145.60458223936988, 132.03546042520492, 123.08259557505123),
'laptop': (141.3166202498071, 140.26932026427468, 142.72052981529706),
'Leopards': (102.7274234008789, 100.92747344970704, 70.22849853515625),
'llama': (126.17889013045874, 119.04773496970152, 103.34148935171274),
'lobster': (155.1705203172637, 135.04048119521724, 129.04027278248856),
'lotus': (109.03726288766572, 106.82734541459517, 90.5983183889678),
'mandolin': (133.36134799691135, 126.5803889784702, 110.98514006858649),
'mayfly': (130.14299468994142, 135.0366241455078, 115.97515411376953),
'menorah': (161.50318364987427, 154.59180669674927, 150.23005904274424),
'metronome': (153.78610801696777, 140.26548385620117, 136.01962661743164),
'minaret': (99.7521434583162, 105.95818690249794, 113.63988535027755),
'Motorbikes': (174.8851556228217, 172.113278343564, 169.69396544339364),
'nautilus': (119.32869318181818, 114.20570845170455, 105.66610773259943),
'octopus': (134.46142403738838, 133.96062883649554, 132.2274379185268),
'okapi': (121.69943628555689, 120.43173452524039, 106.69187262119391),
'pagoda': (104.74957924700797, 104.89284044630985, 105.33054822556515),
'panda': (141.05059332596628, 134.07877711245888, 124.85156571237664),
'pigeon': (147.99663899739582, 149.97787407769098, 144.87070990668403),
'pizza': (169.60810823260613, 135.061258567954, 109.37381384507665),
'platypus': (147.62673770680146, 139.72264727424172, 122.3972006405101),
'pyramid': (155.56406014425713, 147.01211173074287, 141.05792450486567),
'revolver': (174.3037168921494, 161.29030925471608, 155.25864615091464),
'rhino': (130.57705119504766, 125.42717057567532, 109.0287061788268),
'rooster': (164.43339694276148, 153.53070815728634, 136.49310053611288),
'saxophone': (145.16487884521484, 133.06846466064454, 126.2926254272461),
'schooner': (155.67455376519098, 161.71505010695685, 164.9138919890873),
'scissors': (188.77790715144232, 176.58327855819311, 174.8254910982572),
'scorpion': (154.7220429920015, 140.73291088285902, 125.92598252069382),
'sea_horse': (104.03026915433114, 99.82210821854441, 89.53543358518367),
'snoopy': (188.36604701450892, 174.04058314732143, 169.64529680524552),
'soccer_ball': (150.51023960113525, 152.17060470581055, 147.55702209472656),
'stapler': (170.3809312608507, 166.25526394314235, 165.79267578125),
'starfish': (154.18405861078307, 140.21250738099565, 133.01694222383722),
'stegosaurus': (134.37886590472723, 127.79331323655985, 120.19223281084481),
'stop_sign': (177.051775932312, 112.1675615310669, 112.55009841918945),
'strawberry': (155.2713361467634, 107.88239397321429, 106.37772042410714),
'sunflower': (141.18593678193935, 131.21258185891543, 82.35699391084559),
'tick': (178.88940678810587, 177.37993263711735, 161.8416075414541),
'trilobite': (98.66953082417332, 89.79930221202761, 83.63163721838663),
'umbrella': (174.46801025390624, 172.44725260416666, 172.36328287760418),
'watch': (156.52145883727772, 151.44035281895594, 144.50501995006866),
'water_lilly': (96.9601209485853, 97.56450756176098, 84.11524592219172),
'wheelchair': (137.62410102456303, 132.70532019663665, 126.61946855965307),
'wild_cat': (124.67989394244026, 119.22195075539982, 106.21112599092372),
'windsor_chair': (175.21669333321708, 158.4068341936384, 150.5487322126116),
'wrench': (207.43726681440305, 200.0815633138021, 199.77937825520834),
'yin_yang': (143.46784566243488, 142.56166280110676, 137.64887084960938)}


model = load_model("model7.h5")

NAME = "/Users/aravindsudharsan/Desktop/UCSB/Spring 2018/Introduction to Deep Learning/Project/summary jpg files/image_104.jpg"

filename=NAME

path="/Users/aravindsudharsan/Desktop/UCSB/Spring 2018/Introduction to Deep Learning/Project/101_ObjectCategories"
categories = sorted(os.listdir(path))
dict={}
for i, categories in enumerate(categories):
    dict.update({i:categories})
    
print(dict)


def imread(path):
    img = scipy.misc.imresize(scipy.misc.imread(path).astype(np.float),[210,630,3])
    img=img[:,0:210,:]
    print(np.shape(img))
    if len(img.shape) == 2:
        img = np.transpose(np.array([img, img, img]), (2, 0, 1))
    return img


img = scipy.misc.imresize(imread(filename), [128,128, 3])
print(np.shape(img))
img = img.astype('float32')
img[:,:,0] -= 123.68
img[:,:,1] -= 116.78
img[:,:,2] -= 103.94
img1=[img]
img=np.array(img1)
img = img.transpose(0, 3, 1, 2)

img_class = model.predict_classes(img)


print(img_class)
#img_class=[4]
print(dict[img_class[0]])


print("Red:",dict_rgb[dict[img_class[0]]][0],"Green:",dict_rgb[dict[img_class[0]]][1],"Blue:",dict_rgb[dict[img_class[0]]][2],)


target_file = NAME

img=scipy.misc.imresize(scipy.misc.imread(target_file).astype(np.float),[210,630,3]) #Read image as flot values
display = Image.fromarray(img, 'RGB')
display.save('display.jpg')
display.show()
img=img[:,210:420,:]
print(np.shape(img))
# print(np.shape(img))
r,g,b=0,0,0
r_final_mean,g_final_mean,b_final_mean=dict_rgb[dict[img_class[0]]][0],dict_rgb[dict[img_class[0]]][1],dict_rgb[dict[img_class[0]]][2]
for i in range(210):
    for j in range(210):
        r,g,b=r+img[i][j][0],g+img[i][j][1],b+img[i][j][2]
        
r_mean,g_mean,b_mean=r/(210*210),g/(210*210),b/(210*210)

r_diff,g_diff,b_diff=(r_final_mean-r_mean),(g_final_mean-g_mean),(b_final_mean-b_mean)
print(type(r_diff))


for i in range(210):
    for j in range(210):
        img[i][j][0],img[i][j][1],img[i][j][2]=img[i][j][0]+r_diff,img[i][j][1]+g_diff,img[i][j][2]+b_diff
        
display = Image.fromarray(img, 'RGB')
display.save('display4.jpg')
display.show()

